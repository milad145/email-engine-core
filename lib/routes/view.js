/* clients.js */import path from 'path';import {URL} from "url";import express from "express"import {ObjectId} from "mongodb"import application from "../core/application.js";import {isLogin} from "../core/middleware.js"import {setResponseCode, setErrorResponse, decrypt} from "../utils/utility.js";import passport from "passport";let router = express.Router();//*********************** POST ***********************//router.post('/api/webhook', (req, res) => {    const {userId} = req.body.value[0];    return application.syncSubscription(userId)        .then(() => res.send(true))        .catch(err => setErrorResponse(req, res, err))});//*********************** GET ***********************//router.get("/", isLogin, (req, res) => {    res.render('index')});router.get("/login", (req, res) => {    res.render('login')});router.get("/login-azure", passport.authenticate('azuread-openidconnect'));router.get("/azure-callback", passport.authenticate('azuread-openidconnect', {failureRedirect: '/'}),    (req, res) => {        res.redirect('/');    });router.get("/login-facebook", passport.authenticate("facebook"))router.get("/facebook-callback", passport.authenticate("facebook"), (req, res) => {    res.redirect("/")})router.get("/login-google", passport.authenticate("google"))router.get("/google-callback", passport.authenticate("google"), (req, res) => {    res.redirect("/")})router.get("/sync-mails", isLogin, function (req, res) {    let {user} = req.session.passport;    application.syncMails(user._id, decrypt(user.accessToken))        .then(() => res.send(true))        .catch(err => {            setErrorResponse(req, res, err)            // res.json(err)        })})export default router;