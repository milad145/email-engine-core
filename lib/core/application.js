import {ObjectId} from 'mongodb';import {Client} from "@microsoft/microsoft-graph-client";import {PublicClientApplication, ConfidentialClientApplication} from "@azure/msal-node";import db from '../data/db.js';import {setResponseCode} from "../utils/utility.js";let clientId, clientSecret, tenantId, redirectUri, scopes, msalConfig, pca, ccaConfig, cca;/** * Set Default Data */export function setterData() {    clientId = SecConfig['clientID'];    clientSecret = SecConfig['secretID'];    tenantId = SecConfig['tenantID'];    redirectUri = EnvConfig['redirectUrl'];    scopes = EnvConfig['scopes'];    msalConfig = {        auth: {            clientId,            authority: `https://login.microsoftonline.com/${tenantId}`,            redirectUri,        },    };    pca = new PublicClientApplication(msalConfig);    ccaConfig = {        auth: {            clientId,            authority: `https://login.microsoftonline.com/${tenantId}`,            clientSecret,        },    };    cca = new ConfidentialClientApplication(ccaConfig)}const application = {    /**     * User Authentication     * @returns {Promise<string>}     */    login: () => {        return new Promise((resolve, reject) => {            const authCodeUrlParameters = {                scopes,                redirectUri,            };            pca.getAuthCodeUrl(authCodeUrlParameters)                .then(response => {                    resolve(response);                })                .catch(err => reject(err))        })    },    /**     * Get user-specific access token     * @param code {String}     * @returns {Promise<String>}     */    azureOAuthRedirection: (code) => {        return new Promise((resolve, reject) => {            const tokenRequest = {                code: code,                scopes,                redirectUri,                clientSecret: clientSecret,            };            pca.acquireTokenByCode(tokenRequest)                .then(response => {                    // Store the user-specific access token in the session for future use                    resolve(response.accessToken)                })                .catch(err => reject(err));        })    },    /**     * Get client-specific access token     * @returns {Promise<String>}     */    azureClientAccessToken: () => {        return new Promise((resolve, reject) => {            const tokenRequest = {                scopes,                clientSecret: clientSecret,            }            cca.acquireTokenByClientCredential(tokenRequest)                .then(response => resolve(response.accessToken))                .catch(err => reject(err))        })    },    getMails: (num, userAccessToken) => {        return new Promise((resolve, reject) => {            const client = Client.init({                authProvider: (done) => {                    done(null, userAccessToken);                },            });            client.api("/me/messages").top(num).get()                .then(messages => resolve(messages))                .catch(err => reject(err))        })    }}export default application